# MySQL 8.4 — custom configuration
# Mounted read-only at /etc/mysql/conf.d/custom.cnf inside the container.
#
# After changing any value here, restart the container:
#   docker compose restart mysql
#
# To verify an active value:
#   docker compose exec mysql mysql -u root -p \
#     -e "SHOW VARIABLES LIKE 'innodb_buffer_pool_size';"

[mysqld]

# ─── Character set & collation ────────────────────────────────────────────────
# utf8mb4 stores full Unicode (including emoji).
# utf8mb4_unicode_ci is case-insensitive, accent-insensitive, and broadly
# compatible with existing applications.
# Alternative: utf8mb4_0900_ai_ci — the MySQL 8.x native default, faster
# for new projects that don't need to support older clients.
character-set-server  = utf8mb4
collation-server      = utf8mb4_unicode_ci

# ─── Network ──────────────────────────────────────────────────────────────────
# Inside the container MySQL must listen on all interfaces so Docker's port
# mapping (127.0.0.1:3306 → container:3306) can reach it.
# External access restriction is enforced at the Docker level via the
# host binding in docker-compose.yml — do NOT relax that binding carelessly.
bind-address = 0.0.0.0

# ─── Connections ──────────────────────────────────────────────────────────────
max_connections     = 100
wait_timeout        = 600
interactive_timeout = 600

# ─── InnoDB / Storage ─────────────────────────────────────────────────────────
# Set innodb_buffer_pool_size to ~50–70 % of available RAM on a dedicated host.
# 256 M is a safe conservative default for a shared or development machine.
innodb_buffer_pool_size        = 256M
# innodb_log_file_size was removed in MySQL 8.4.
# The replacement is innodb_redo_log_capacity (total redo log size).
# 128M ≈ equivalent of the previous 2 × 64 M default.
innodb_redo_log_capacity       = 128M
innodb_flush_log_at_trx_commit = 1   # 1 = fully ACID-safe
innodb_file_per_table          = ON

# ─── Slow-query log ───────────────────────────────────────────────────────────
slow_query_log      = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time     = 2   # seconds

# ─── Security ─────────────────────────────────────────────────────────────────
# Disable LOAD DATA LOCAL INFILE — commonly exploited in shared environments.
local_infile = 0

# ─── Binary log (disabled by default) ────────────────────────────────────────
# Uncomment to enable binary logging for point-in-time recovery or replication.
# Increases disk usage.
# log_bin                      = /var/log/mysql/mysql-bin
# binlog_format                = ROW
# binlog_expire_logs_seconds   = 604800   # 7 days (expire_logs_days removed in 8.4)

[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4
